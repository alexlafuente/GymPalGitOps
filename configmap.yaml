# ============================================================
# CONFIGMAP â€” Safe Environment Variables and NGINX Config
# ============================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: gympal-config
data:
  # ================================
  # Shared Config (Frontend + Backend)
  # ================================
  NODE_ENV: "production"

  # ================================
  # Frontend (Vite)
  # ================================
  VITE_API_URL: "https://gympal.example.com/api,http://localhost:3000" # Comma-separated list of backend API URLs for frontend to use
  

  # ================================
  # Backend - Non-sensitive config
  # ================================
  PORT: "3000"
  JWT_EXPIRY: "7d" # JWT expiry duration
  CORS_ORIGIN: "https://gympal.example.com,http://localhost:3000,http://localhost:5173" # Comma-separated list of allowed CORS origins
  CORS_CREDENTIALS: "true" # Whether to allow credentials in CORS
  RATE_LIMIT_WINDOW_MS: "900000" # 15 minutes in milliseconds
  RATE_LIMIT_MAX_REQUESTS: "1000" # Max requests per window per IP
  LOG_LEVEL: "info" # Logging level (e.g., error, warn, info, debug)
  
  # ================================
  # Database - Non-sensitive config
  # ================================
  
  POSTGRES_DB: "gympal_dev"
  
  # ================================
  # SMTP (Optional dev config)
  # ================================
  SMTP_HOST: "smtp.example.com"
  SMTP_PORT: "587"
  SMTP_USER: "your_email@example.com"

  # ================================
  # NGINX config for frontend SPA
  # ================================
  # This config enables proper routing for a Single Page Application (SPA)
  nginx.conf: |
    server {
        listen 80;
        server_name _;
        root /usr/share/nginx/html;
        index index.html;

        location / {
            try_files $uri $uri/ /index.html;
        }

        location /assets/ {
            access_log off;
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
